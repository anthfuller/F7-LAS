# Appendix A — Schemas
This appendix defines the minimal, vendor-neutral telemetry schemas required to support F7-LAS Layers 1–7.
These schemas ensure agent behavior is observable, auditable, and measurable across planning, grounding, tool execution, policy decisions, and system events.

These are reference schemas.
Implementers may extend them, but removing fields is discouraged because it reduces observability.

## A.1 Prompt Event Schema (Layer 1 — System Prompt)
Represents a system-prompt load event or a prompt-version change.

json
Copy code
{
  "event_type": "prompt_load",
  "timestamp": "2025-01-01T12:00:00Z",
  "agent_id": "coordinator",
  "prompt_version": "v7.2",
  "prompt_hash": "sha256:4f2ab91...",
  "psp_id": "psp-coordinator-001",
  "change_ticket": "CAB-2025-114",
  "approver": "sec-arch"
}
Supports:

Prompt-drift detection

PSP version enforcement

CAB review traceability

## A.2 Planner Step Schema (Layer 3 — Planner / Controller)
Represents a single reasoning step inside a ReAct/PDDL/hybrid planner loop.

json
Copy code
{
  "event_type": "planner_step",
  "timestamp": "2025-01-01T12:30:01Z",
  "agent_id": "investigator",
  "step_number": 4,
  "reasoning_trace": "Reviewing alert details...",
  "planned_action": "query_siem",
  "stop_condition_triggered": false,
  "max_steps": 12,
  "loop_terminated": false
}
Supports:

Loop-termination SLOs

Unsafe planning detection (Layer 3)

ATLAS-aligned anomaly analysis

## A.3 RAG Retrieval Event Schema (Layer 2 — Grounding)
Represents one retrieval operation used for grounding.

json
Copy code
{
  "event_type": "rag_retrieval",
  "timestamp": "2025-01-01T12:35:01Z",
  "trace_id": "abc123",
  "agent_id": "coordinator",
  "query": "latest password reset policy",
  "source_id": "policy_kb",
  "document_ids": ["doc-4421", "doc-9921"],
  "top_k": 5,
  "avg_trust_score": 0.93,
  "min_trust_score": 0.88,
  "poisoning_flags": {
    "suspicious_terms": false,
    "out_of_domain": false
  }
}
Supports:

RAG poisoning detection

Retrieval-quality scores

Layer-2 observability

## A.4 Tool Call Request Schema (Layer 4 — Tool Surface)
Represents the tool invocation request generated by the planner.

json
Copy code
{
  "event_type": "tool_call_request",
  "timestamp": "2025-01-01T12:40:15Z",
  "trace_id": "req-9912",
  "agent_id": "remediator",
  "tool_name": "isolate_endpoint",
  "tool_args": {
    "device_id": "host-11",
    "reason": "ransomware_suspected"
  },
  "tool_schema_version": "v2.0",
  "credential_scope": "sp-remediator-limited",
  "risk_score": 0.82
}
Supports:

Tool-misuse detection

Over-privilege prevention

Credential-scope audits

## A.5 Policy Decision (PDP) Schema (Layer 5 — Hard Guardrails)
Represents a PDP evaluation for a tool request.

json
Copy code
{
  "event_type": "policy_decision",
  "timestamp": "2025-01-01T12:40:16Z",
  "trace_id": "req-9912",
  "subject": {
    "agent_id": "remediator",
    "delegated_user": "sec_analyst_03",
    "agent_trust_score": 0.91
  },
  "action": "isolate_endpoint",
  "resource": "host-11",
  "context": {
    "risk_level": "high",
    "time_of_day": "after_hours"
  },
  "decision": "permit_with_obligation",
  "obligations": ["mask_sensitive_fields"],
  "policy_id": "abac-rule-22"
}
Supports:

Layer-5 enforcement

Policy-bypass detection

HITL override triggers

## A.6 Tool Execution Result Schema (Layer 4 / Layer 6)
Represents the outcome of tool execution inside the sandbox.

json
Copy code
{
  "event_type": "tool_execution_result",
  "timestamp": "2025-01-01T12:40:18Z",
  "trace_id": "req-9912",
  "tool_name": "isolate_endpoint",
  "status": "success",
  "execution_time_ms": 420,
  "sandbox_id": "aca-sbx-033",
  "egress_limited": true,
  "output": {
    "message": "Endpoint isolation initiated.",
    "ticket_id": "IR-22991"
  }
}
Supports:

Sandbox-boundary validation

Tool reliability scoring

Layer-6 blast-radius analysis

## A.7 Monitoring & Evaluation Event Schema (Layer 7)
Represents an agent monitoring event, typically logged to SIEM/SOC.

json
Copy code
{
  "event_type": "agent_monitor_event",
  "timestamp": "2025-01-01T12:45:00Z",
  "agent_id": "coordinator",
  "metrics": {
    "planner_loop_termination_rate": 1.0,
    "tool_failure_rate": 0.02,
    "rag_trust_score_avg": 0.91,
    "telemetry_completeness": 0.97
  },
  "drift_signals": {
    "prompt_drift": false,
    "rag_dataset_drift": false,
    "tool_permission_drift": true
  },
  "alerts_raised": ["sandbox_permission_expansion"]
}
Supports:

Drift detection

SLO measurement

ATLAS-aligned threat visibility

## A.8 Multi-Agent Choreography Schema (Optional)
Represents cross-agent coordination events.

json
Copy code
{
  "event_type": "multi_agent_coordination",
  "timestamp": "2025-01-01T12:50:12Z",
  "source_agent": "coordinator",
  "target_agent": "investigator",
  "handoff_reason": "requires_deep_alert_analysis",
  "task_context": {
    "alert_id": "A-55210",
    "severity": "high"
  }
}
Supports:

Multi-agent audit trails

Escalation modeling

Provenance of automated decisions
